<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œì„ì²´í¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f9fafb; }
        .tabs { background: white; border-bottom: 2px solid #e5e7eb; display: flex; }
        .tab { padding: 16px 32px; cursor: pointer; font-weight: 600; color: #6b7280; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab:hover { background: #f9fafb; }
        .tab.active { color: #2563eb; border-bottom-color: #2563eb; }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        h1 { font-size: 24px; font-weight: bold; margin-bottom: 16px; }
        h2 { font-size: 20px; font-weight: bold; margin-bottom: 12px; margin-top: 24px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn-sec { background: #e5e7eb; color: #374151; }
        .btn-sec:hover { background: #d1d5db; }
        .btn-sec.active { background: #2563eb; color: white; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-success { background: #16a34a; color: white; }
        .btn-danger { background: #dc2626; color: white; }
        .input-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; text-align: center; color: white; border-radius: 12px; }
        .input-section h2 { font-size: 24px; margin-bottom: 20px; }
        .input-section input { font-size: 32px; padding: 16px; border: none; border-radius: 8px; width: 100%; max-width: 400px; text-align: center; }
        #msg { margin-top: 16px; padding: 12px; border-radius: 8px; font-size: 16px; font-weight: bold; display: none; }
        #msg.success { background: #10b981; }
        #msg.error { background: #ef4444; }
        #msg.warning { background: #f59e0b; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat { background: #f9fafb; border: 2px solid #e5e7eb; padding: 20px; text-align: center; border-radius: 8px; }
        .stat-num { font-size: 36px; font-weight: bold; }
        .stat.total .stat-num { color: #2563eb; }
        .stat.present .stat-num { color: #16a34a; }
        .stat.late .stat-num { color: #f97316; }
        .stat.absent .stat-num { color: #dc2626; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f3f4f6; padding: 12px; text-align: left; border-bottom: 2px solid #d1d5db; font-weight: 600; }
        td { padding: 12px; border-bottom: 1px solid #e5e7eb; }
        tr:hover { background: #f9fafb; }
        .badge { padding: 6px 16px; border-radius: 20px; font-weight: 600; font-size: 13px; }
        .badge.present { background: #dcfce7; color: #166534; }
        .badge.late { background: #fed7aa; color: #9a3412; }
        .badge.absent { background: #fee2e2; color: #991b1b; }
        .badge.excused { background: #f3f4f6; color: #374151; }
        .badge.none { background: #f9fafb; color: #9ca3af; }
        .seating-container { background: white; padding: 20px; border-radius: 8px; overflow-x: auto; }
        .floor-label { background: #2563eb; color: white; padding: 8px 16px; font-weight: bold; font-size: 14px; text-align: center; margin-bottom: 16px; border-radius: 4px; }
        .seat-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 30px; }
        .seat { background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 12px 8px; text-align: center; min-height: 80px; display: flex; flex-direction: column; justify-content: center; transition: all 0.2s; position: relative; }
        .seat.empty { background: #f9fafb; border-style: dashed; opacity: 0.5; }
        .seat.blocked { background: #1f2937; opacity: 0.3; }
        .seat.blocked::before { content: 'âœ•'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: #6b7280; }
        .seat-number { font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px; }
        .seat-id { font-size: 13px; color: #374151; font-weight: 500; margin-bottom: 2px; }
        .seat-name { font-size: 15px; font-weight: bold; color: #111827; }
        .seat.present { background: #dcfce7; border-color: #16a34a; }
        .seat.late { background: #fed7aa; border-color: #f97316; }
        .seat.absent { background: #fee2e2; border-color: #dc2626; }
        .seat.excused { background: #f3f4f6; border-color: #6b7280; }
        .legend { display: flex; gap: 16px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-box { width: 20px; height: 20px; border-radius: 4px; border: 2px solid; }
        .legend-box.present { background: #dcfce7; border-color: #16a34a; }
        .legend-box.late { background: #fed7aa; border-color: #f97316; }
        .legend-box.absent { background: #fee2e2; border-color: #dc2626; }
        .legend-box.excused { background: #f3f4f6; border-color: #6b7280; }
        .admin-login { max-width: 400px; margin: 100px auto; }
        .admin-content { display: none; }
        .admin-content.show { display: block; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .student-list { display: grid; gap: 12px; }
        .student-item { display: grid; grid-template-columns: 100px 150px 200px auto; gap: 12px; align-items: center; padding: 12px; background: #f9fafb; border-radius: 6px; }
        .student-item input { padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; }
        .seat-editor { display: grid; gap: 8px; margin-bottom: 30px; }
        .seat-edit-cell { background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 12px 8px; text-align: center; min-height: 80px; display: flex; flex-direction: column; justify-content: center; cursor: move; transition: all 0.2s; }
        .seat-edit-cell:hover { background: #f3f4f6; border-color: #2563eb; }
        .seat-edit-cell.empty { background: #f9fafb; border-style: dashed; opacity: 0.5; cursor: pointer; }
        .seat-edit-cell.dragging { opacity: 0.5; }
        .seat-edit-cell.drag-over { background: #dbeafe; border-color: #3b82f6; border-style: dashed; }
        .seat-edit-number { font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px; }
        .seat-edit-id { font-size: 13px; color: #374151; font-weight: 500; margin-bottom: 2px; }
        .seat-edit-name { font-size: 15px; font-weight: bold; color: #111827; }
    </style>
</head>
<body>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('attendance')">ğŸ“‹ ì¶œì„ì²´í¬</div>
        <div class="tab" onclick="switchTab('seating')">ğŸª‘ ì¢Œì„í‘œ</div>
        <div class="tab" onclick="switchTab('admin')">âš™ï¸ ê´€ë¦¬</div>
    </div>
    
    <div id="attendance-tab" class="tab-content active">
        <div class="container">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h1>ê²¨ìš¸ë°©í•™ ììœ¨í•™ìŠµ</h1>
                    <button class="btn btn-success" onclick="download()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                </div>
                <div class="controls">
                    <div>
                        <div style="margin-bottom: 8px; font-weight: 500;">í•™ë…„</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-sec active" onclick="setGrade('all')">ì „ì²´</button>
                            <button class="btn btn-sec" onclick="setGrade('1')">1í•™ë…„</button>
                            <button class="btn btn-sec" onclick="setGrade('2')">2í•™ë…„</button>
                        </div>
                    </div>
                    <div>
                        <div style="margin-bottom: 8px; font-weight: 500;">ì‹œê°„</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-sec active" onclick="setTime('ì˜¤ì „')">ì˜¤ì „</button>
                            <button class="btn btn-sec" onclick="setTime('ì˜¤í›„')">ì˜¤í›„</button>
                        </div>
                    </div>
                </div>
                <div style="background: #dbeafe; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <input type="date" id="date" onchange="update()" style="padding: 8px; border: 1px solid #93c5fd; border-radius: 6px; margin-bottom: 8px;">
                    <div id="dateDisplay" style="font-size: 18px; font-weight: bold; color: #1e40af;"></div>
                    <div id="timeDisplay" style="font-size: 14px; color: #374151;"></div>
                </div>
            </div>
            <div class="card input-section">
                <h2>í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”</h2>
                <input type="text" id="input" placeholder="ì˜ˆ: 10102" maxlength="5" autofocus>
                <div id="msg"></div>
            </div>
            <div class="stats">
                <div class="stat total"><div class="stat-num" id="total">0</div><div>ì „ì²´</div></div>
                <div class="stat present"><div class="stat-num" id="present">0</div><div>ì¶œì„</div></div>
                <div class="stat late"><div class="stat-num" id="late">0</div><div>ì§€ê°</div></div>
                <div class="stat absent"><div class="stat-num" id="absent">0</div><div>ê²°ì„</div></div>
            </div>
            <div class="card">
                <h1>ì¶œì„ í˜„í™©</h1>
                <table>
                    <thead><tr><th>í•™ë²ˆ</th><th>ì´ë¦„</th><th style="text-align:center;">ìƒíƒœ</th><th style="text-align:center;">ë¶ˆì°¸</th></tr></thead>
                    <tbody id="table"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="seating-tab" class="tab-content">
        <div class="container">
            <div class="card">
                <h1>ì¢Œì„í‘œ</h1>
                <div class="legend">
                    <div class="legend-item"><div class="legend-box present"></div><span>ì¶œì„</span></div>
                    <div class="legend-item"><div class="legend-box late"></div><span>ì§€ê°</span></div>
                    <div class="legend-item"><div class="legend-box absent"></div><span>ê²°ì„</span></div>
                    <div class="legend-item"><div class="legend-box excused"></div><span>ë¶ˆì°¸</span></div>
                    <div class="legend-item"><div class="legend-box" style="background:white;border-color:#e5e7eb;"></div><span>ë¯¸ì²´í¬</span></div>
                </div>
            </div>
            <div class="seating-container"><div id="seating-chart"></div></div>
        </div>
    </div>
    
    <div id="admin-tab" class="tab-content">
        <div class="container">
            <div class="admin-login card" id="admin-login">
                <h1>ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="admin-pass">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="adminLogin()">ë¡œê·¸ì¸</button>
            </div>
            
            <div class="admin-content" id="admin-content">
                <div class="card">
                    <h1>ê´€ë¦¬ì ì„¤ì •</h1>
                    <button class="btn btn-danger" onclick="adminLogout()" style="float: right;">ë¡œê·¸ì•„ì›ƒ</button>
                    <div style="clear: both;"></div>
                </div>
                
                <div class="card">
                    <h2>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h2>
                    <div class="form-group">
                        <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="new-password">
                    </div>
                    <div class="form-group">
                        <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <input type="password" id="confirm-password">
                    </div>
                    <button class="btn btn-primary" onclick="changePassword()">ë³€ê²½</button>
                </div>
                
                <div class="card">
                    <h2>ì¶œì„ ìˆ˜ë™ ë³€ê²½</h2>
                    <div class="form-group">
                        <label>í•™ë²ˆ</label>
                        <input type="text" id="manual-id" placeholder="ì˜ˆ: 10102">
                    </div>
                    <div class="form-group">
                        <label>ìƒíƒœ</label>
                        <select id="manual-status">
                            <option value="present">ì¶œì„</option>
                            <option value="late">ì§€ê°</option>
                            <option value="absent">ê²°ì„</option>
                            <option value="excused">ë¶ˆì°¸</option>
                            <option value="none">ë¯¸ì²´í¬</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="manualChange()">ë³€ê²½</button>
                </div>
                
                <div class="card">
                    <h2>í•™ìƒ ì •ë³´ ê´€ë¦¬</h2>
                    <div style="margin-bottom: 16px;">
                        <button class="btn btn-sec" onclick="showStudentGrade('1')">1í•™ë…„</button>
                        <button class="btn btn-sec" onclick="showStudentGrade('2')">2í•™ë…„</button>
                    </div>
                    <div id="student-list" class="student-list"></div>
                    <button class="btn btn-success" onclick="addStudent()" style="margin-top: 16px;">+ í•™ìƒ ì¶”ê°€</button>
                </div>
                
                <div class="card">
                    <h2>ì¢Œì„ ë°°ì¹˜ í¸ì§‘</h2>
                    <p style="margin-bottom: 16px; color: #6b7280;">ì¢Œì„ì„ ë“œë˜ê·¸í•˜ì—¬ ì´ë™í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ í•™ìƒì„ ë°°ì¹˜í•˜ì„¸ìš”</p>
                    <div style="margin-bottom: 16px;">
                        <button class="btn btn-sec" onclick="editSeatingGrade('1')">1í•™ë…„</button>
                        <button class="btn btn-sec" onclick="editSeatingGrade('2')">2í•™ë…„</button>
                    </div>
                    <div style="margin-bottom: 16px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; max-width: 500px;">
                        <div class="form-group" style="margin: 0;">
                            <label>ì„¸ë¡œ ì¤„ ìˆ˜</label>
                            <input type="number" id="seat-rows" min="1" max="50" value="23" style="padding: 8px;">
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label>ê°€ë¡œ ì—´ ìˆ˜</label>
                            <input type="number" id="seat-cols" min="1" max="10" value="5" style="padding: 8px;">
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="resizeSeating()" style="width: 100%;">í¬ê¸° ë³€ê²½</button>
                        </div>
                    </div>
                    <div id="seating-editor"></div>
                </div>
                
                <div class="card">
                    <h2>ë°ì´í„° ê´€ë¦¬</h2>
                    <button class="btn btn-danger" onclick="resetAttendance()" style="margin-right: 8px;">ì¶œì„ ë°ì´í„° ì´ˆê¸°í™”</button>
                    <button class="btn btn-danger" onclick="resetAll()">ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

<script>
let g1=[{í•™ë²ˆ:'10102',ì´ë¦„:'ê¹€ë„ìœ¤',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10103',ì´ë¦„:'ê¹€ë„í›ˆ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10106',ì´ë¦„:'ê¹€ì¬í˜„',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10115',ì´ë¦„:'ì´ê±´ìƒ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10116',ì´ë¦„:'ì´ê¸°í˜',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10117',ì´ë¦„:'ì´ì„œì¤€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10119',ì´ë¦„:'ì´ìœ¤ì°¬',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10123',ì´ë¦„:'ê¹€ë³´ì„±',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10223',ì´ë¦„:'ì´ì„œì¤€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10306',ì´ë¦„:'ì´ìŠ¹ì¤€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10320',ì´ë¦„:'ì¡°í˜„ì„',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10505',ì´ë¦„:'ê¶Œê°€ì—°',ë¶ˆì°¸:'ìˆ˜ ì˜¤ì „/ì˜¤í›„'},{í•™ë²ˆ:'10508',ì´ë¦„:'ê¹€ìœ¤ì±„',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „'},{í•™ë²ˆ:'10513',ì´ë¦„:'ë°•ì§€í›„',ë¶ˆì°¸:'ê¸ˆ ì˜¤í›„'},{í•™ë²ˆ:'10516',ì´ë¦„:'ì´ì§€ìš°',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10601',ì´ë¦„:'ê¹€ì„¸ì—°',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10608',ì´ë¦„:'ìœ ì§€ì›',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10609',ì´ë¦„:'ì´ë‚˜ìš´',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10611',ì´ë¦„:'ì´ë£¨ë¦¬',ë¶ˆì°¸:'ëª© ì˜¤í›„'},{í•™ë²ˆ:'10612',ì´ë¦„:'ì´ì†Œìœ¤',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10613',ì´ë¦„:'ì´ì˜ì¸',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10618',ì´ë¦„:'ì •í¬ë€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10619',ì´ë¦„:'ìµœì§„ê²½',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10805',ì´ë¦„:'ê¹€ë³´ë¯¸',ë¶ˆì°¸:'í™” ì˜¤í›„'},{í•™ë²ˆ:'10815',ì´ë¦„:'ìœ ì œë‹ˆ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10901',ì´ë¦„:'ê¹€ë¯¼ì„œ',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „'},{í•™ë²ˆ:'10903',ì´ë¦„:'ê¹€ì‹œí˜„',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „/ì˜¤í›„'},{í•™ë²ˆ:'10904',ì´ë¦„:'ê¹€í•˜ëŒ',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „'},{í•™ë²ˆ:'10905',ì´ë¦„:'ì„œí•˜ì€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'10907',ì´ë¦„:'ìœ ë¯¼ì •',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „'},{í•™ë²ˆ:'10910',ì´ë¦„:'ì´ë‚˜ìœ¤',ë¶ˆì°¸:'ê¸ˆ ì˜¤ì „'}];
let g2=[{í•™ë²ˆ:'20101',ì´ë¦„:'ê¹€ë™í•˜',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20113',ì´ë¦„:'ì´ì¬ê²½',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20215',ì´ë¦„:'ì •ë¯¼ê·œ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20301',ì´ë¦„:'ê¹€ì„ ìš°',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20307',ì´ë¦„:'ë°•ì´ì—˜',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20313',ì´ë¦„:'ìœ¤ì—¬ëª…',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20418',ì´ë¦„:'ìœ¤ì£¼ì„±',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20714',ì´ë¦„:'ì´ìœ ì˜¨',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20801',ì´ë¦„:'ê°•ë‹¤ì—°',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20802',ì´ë¦„:'ê°•ì„œìœ ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20807',ì´ë¦„:'ê¹€ë¯¼ì„œ',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20810',ì´ë¦„:'ì„œì¤€ì˜',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20811',ì´ë¦„:'ì„œì§€ë¯¼',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'20815',ì´ë¦„:'ì´ì„œìœ¤',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'21005',ì´ë¦„:'ê¹€ì±„ì˜',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'21010',ì´ë¦„:'ë°±ì†Œì€',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'21020',ì´ë¦„:'ì´ì˜ˆë‹´',ë¶ˆì°¸:'-'},{í•™ë²ˆ:'21022',ì´ë¦„:'ì •ì±„ë¦°',ë¶ˆì°¸:'-'}];
let seatingLayout={'2':[['21022','20810','21020','20815','21005'],[null,null,null,null,null],['20807',null,null,null,'20811'],[null,null,null,null,null],['20802','20801','20714',null,null],[null,null,null,null,null],[null,null,null,'20418','20313'],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,'20307',null,null],[null,null,null,null,null],[null,null,'20301',null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,'20215',null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,'20113',null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,'20101',null,null]],'1':[[null,null,'10619','10618','10508'],[null,null,null,null,null],['10805','10513','10516','10612',null],[null,null,null,null,null],['10903','10904','10905','10907','10910'],[null,null,null,null,null],['10505','10608','10601','10611','10901'],[null,null,null,null,null],['10903','10904','10905','10907','10910'],[null,null,null,null,null],['10505','10601','10608','10612','10901'],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],['10320','10106',null,null,'10119'],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,'10306','10116','10117'],[null,null,null,null,null],['10320','10106','10223',null,'10123'],[null,null,null,null,null],[null,null,'10103','10102','10115']]};
let seatNumbers={'1':{},'2':{}};
let s={grade:'all',time:'ì˜¤ì „',date:new Date().toISOString().split('T')[0],att:{},pw:localStorage.getItem('pw')||'1234',adminLoggedIn:false};
let dragData={grade:null,fromRow:null,fromCol:null};

function saveData(){localStorage.setItem('students1',JSON.stringify(g1));localStorage.setItem('students2',JSON.stringify(g2));localStorage.setItem('seating',JSON.stringify(seatingLayout));localStorage.setItem('seatNumbers',JSON.stringify(seatNumbers))}
function loadData(){const s1=localStorage.getItem('students1');const s2=localStorage.getItem('students2');const sl=localStorage.getItem('seating');const sn=localStorage.getItem('seatNumbers');const att=localStorage.getItem('attendance');if(s1)g1=JSON.parse(s1);if(s2)g2=JSON.parse(s2);if(sl)seatingLayout=JSON.parse(sl);if(sn)seatNumbers=JSON.parse(sn);if(att)s.att=JSON.parse(att)}

function switchTab(t){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));if(t==='attendance'){document.querySelector('.tab:nth-child(1)').classList.add('active');document.getElementById('attendance-tab').classList.add('active')}else if(t==='seating'){document.querySelector('.tab:nth-child(2)').classList.add('active');document.getElementById('seating-tab').classList.add('active');renderSeating()}else if(t==='admin'){document.querySelector('.tab:nth-child(3)').classList.add('active');document.getElementById('admin-tab').classList.add('active');if(!s.adminLoggedIn){document.getElementById('admin-login').style.display='block';document.getElementById('admin-content').classList.remove('show')}else{document.getElementById('admin-login').style.display='none';document.getElementById('admin-content').classList.add('show')}}}

function adminLogin(){const pass=document.getElementById('admin-pass').value;if(pass===s.pw){s.adminLoggedIn=true;document.getElementById('admin-login').style.display='none';document.getElementById('admin-content').classList.add('show');document.getElementById('admin-pass').value=''}else{alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤')}}
function adminLogout(){s.adminLoggedIn=false;document.getElementById('admin-login').style.display='block';document.getElementById('admin-content').classList.remove('show')}

function changePassword(){const n=document.getElementById('new-password').value;const c=document.getElementById('confirm-password').value;if(n!==c){alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');return}if(!n){alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');return}s.pw=n;localStorage.setItem('pw',n);alert('ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');document.getElementById('new-password').value='';document.getElementById('confirm-password').value=''}

function manualChange(){const id=document.getElementById('manual-id').value;const status=document.getElementById('manual-status').value;if(!id){alert('í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”');return}const key=`${s.date}_${s.time}_${id}`;if(status==='none'){delete s.att[key]}else{s.att[key]=status}localStorage.setItem('attendance',JSON.stringify(s.att));render();renderSeating();alert('ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');document.getElementById('manual-id').value=''}

function showStudentGrade(grade){const list=document.getElementById('student-list');list.innerHTML='';const students=grade==='1'?g1:g2;students.forEach((st,idx)=>{const div=document.createElement('div');div.className='student-item';div.innerHTML=`<input type="text" value="${st.í•™ë²ˆ}" onchange="updateStudent('${grade}',${idx},'í•™ë²ˆ',this.value)"><input type="text" value="${st.ì´ë¦„}" onchange="updateStudent('${grade}',${idx},'ì´ë¦„',this.value)"><input type="text" value="${st.ë¶ˆì°¸}" onchange="updateStudent('${grade}',${idx},'ë¶ˆì°¸',this.value)"><button class="btn btn-danger" onclick="deleteStudent('${grade}',${idx})">ì‚­ì œ</button>`;list.appendChild(div)})}

function updateStudent(grade,idx,field,value){if(grade==='1')g1[idx][field]=value;else g2[idx][field]=value;saveData();render();renderSeating()}

function deleteStudent(grade,idx){if(!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;if(grade==='1')g1.splice(idx,1);else g2.splice(idx,1);saveData();showStudentGrade(grade);render();renderSeating()}

function addStudent(){const grade=prompt('í•™ë…„ì„ ì…ë ¥í•˜ì„¸ìš” (1 ë˜ëŠ” 2)');if(!grade||grade===null||grade===''){return}if(grade!=='1'&&grade!=='2'){alert('1 ë˜ëŠ” 2ë¥¼ ì…ë ¥í•˜ì„¸ìš”');return}const í•™ë²ˆ=prompt('í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”');if(!í•™ë²ˆ||í•™ë²ˆ===null||í•™ë²ˆ===''){return}const ì´ë¦„=prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');if(!ì´ë¦„||ì´ë¦„===null||ì´ë¦„===''){return}const ë¶ˆì°¸=prompt('ë¶ˆì°¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì—†ìœ¼ë©´ - ì…ë ¥)');const ë¶ˆì°¸ê°’=ë¶ˆì°¸&&ë¶ˆì°¸.trim()!==''?ë¶ˆì°¸.trim():'-';const í•™ìƒ={í•™ë²ˆ:í•™ë²ˆ.trim(),ì´ë¦„:ì´ë¦„.trim(),ë¶ˆì°¸:ë¶ˆì°¸ê°’};if(grade==='1'){g1.push(í•™ìƒ)}else{g2.push(í•™ìƒ)}saveData();render();renderSeating();alert(`${ì´ë¦„.trim()} í•™ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`);const list=document.getElementById('student-list');if(list&&list.innerHTML!==''){showStudentGrade(grade)}}

function editSeatingGrade(grade){
    dragData.grade=grade;
    const editor=document.getElementById('seating-editor');
    editor.innerHTML='';
    const seats=seatingLayout[grade];
    const cols=seats[0]?seats[0].length:5;
    const rows=seats.length;
    document.getElementById('seat-rows').value=rows;
    document.getElementById('seat-cols').value=cols;
    
    editor.className='seat-editor';
    editor.style.gridTemplateColumns=`repeat(${cols}, 1fr)`;
    
    seats.forEach((row,ridx)=>{
        row.forEach((seat,cidx)=>{
            const cell=document.createElement('div');
            cell.className=seat?'seat-edit-cell':'seat-edit-cell empty';
            cell.dataset.row=ridx;
            cell.dataset.col=cidx;
            const seatKey=`${ridx}-${cidx}`;
            const seatNum=seatNumbers[grade][seatKey]||'';
            if(seat){
                const st=[...g1,...g2].find(x=>x.í•™ë²ˆ===seat);
                cell.innerHTML=`<div class="seat-edit-number">${seatNum}</div><div class="seat-edit-id">${seat}</div><div class="seat-edit-name">${st?st.ì´ë¦„:''}</div>`;
                cell.draggable=true;
                cell.addEventListener('dragstart',handleDragStart);
                cell.addEventListener('dragend',handleDragEnd)
            }else{
                cell.innerHTML=`<div class="seat-edit-number">${seatNum}</div>`
            }
            cell.addEventListener('dragover',handleDragOver);
            cell.addEventListener('drop',handleDrop);
            cell.addEventListener('dragleave',handleDragLeave);
            cell.onclick=()=>{
                if(!cell.classList.contains('dragging')){
                    const newNum=prompt('ì¢Œì„ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1)');
                    if(newNum!==null){seatNumbers[grade][seatKey]=newNum.trim()}
                    const newId=prompt('í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš” (ë¹ˆ ìë¦¬ëŠ” ì·¨ì†Œ)');
                    if(newId===null){saveData();editSeatingGrade(grade);return}
                    if(newId.trim()){
                        const existingSt=[...g1,...g2].find(x=>x.í•™ë²ˆ===newId.trim());
                        if(!existingSt){
                            const newName=prompt('ìƒˆ í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
                            if(newName){
                                if(newId.startsWith('1'))g1.push({í•™ë²ˆ:newId.trim(),ì´ë¦„:newName.trim(),ë¶ˆì°¸:'-'});
                                else if(newId.startsWith('2'))g2.push({í•™ë²ˆ:newId.trim(),ì´ë¦„:newName.trim(),ë¶ˆì°¸:'-'})
                            }
                        }
                        seatingLayout[grade][ridx][cidx]=newId.trim()||null
                    }else{seatingLayout[grade][ridx][cidx]=null}
                    saveData();
                    editSeatingGrade(grade);
                    renderSeating()
                }
            };
            editor.appendChild(cell)
        })
    });
}

function handleDragStart(e){e.target.classList.add('dragging');dragData.fromRow=parseInt(e.target.dataset.row);dragData.fromCol=parseInt(e.target.dataset.col)}

function handleDragEnd(e){e.target.classList.remove('dragging')}

function handleDragOver(e){e.preventDefault();e.target.classList.add('drag-over')}

function handleDragLeave(e){e.target.classList.remove('drag-over')}

function handleDrop(e){e.preventDefault();e.target.classList.remove('drag-over');const toRow=parseInt(e.currentTarget.dataset.row);const toCol=parseInt(e.currentTarget.dataset.col);if(dragData.fromRow===toRow&&dragData.fromCol===toCol)return;const temp=seatingLayout[dragData.grade][dragData.fromRow][dragData.fromCol];seatingLayout[dragData.grade][dragData.fromRow][dragData.fromCol]=seatingLayout[dragData.grade][toRow][toCol];seatingLayout[dragData.grade][toRow][toCol]=temp;saveData();editSeatingGrade(dragData.grade);renderSeating()}

function resizeSeating(){const rows=parseInt(document.getElementById('seat-rows').value);const cols=parseInt(document.getElementById('seat-cols').value);if(!dragData.grade){alert('í•™ë…„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”');return}if(rows<1||rows>50||cols<1||cols>10){alert('ì„¸ë¡œëŠ” 1-50, ê°€ë¡œëŠ” 1-10 ë²”ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”');return}const currentSeats=seatingLayout[dragData.grade];const newSeats=[];for(let r=0;r<rows;r++){const newRow=[];for(let c=0;c<cols;c++){if(currentSeats[r]&&currentSeats[r][c]!==undefined){newRow.push(currentSeats[r][c])}else{newRow.push(null)}}newSeats.push(newRow)}seatingLayout[dragData.grade]=newSeats;saveData();editSeatingGrade(dragData.grade);renderSeating();alert('ì¢Œì„ í¬ê¸°ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤')}

function resetAttendance(){if(!confirm('ì¶œì„ ë°ì´í„°ë§Œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (í•™ìƒ ì •ë³´ì™€ ì¢Œì„ ë°°ì¹˜ëŠ” ìœ ì§€ë©ë‹ˆë‹¤)'))return;s.att={};localStorage.removeItem('attendance');render();renderSeating();alert('ì¶œì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤')}

function resetAll(){if(!confirm('ì •ë§ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  í•™ìƒ ì •ë³´, ì¢Œì„ ë°°ì¹˜, ì¶œì„ ë°ì´í„°ê°€ ì‚­ì œë˜ê³  ë¹ˆ ìƒíƒœê°€ ë©ë‹ˆë‹¤.\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!'))return;g1=[];g2=[];const emptyRow=[];for(let i=0;i<5;i++)emptyRow.push(null);const emptySeats=[];for(let i=0;i<5;i++)emptySeats.push([...emptyRow]);seatingLayout={'1':emptySeats.map(r=>[...r]),'2':emptySeats.map(r=>[...r])};seatNumbers={'1':{},'2':{}};s.att={};localStorage.clear();s.pw='1234';localStorage.setItem('pw','1234');saveData();render();renderSeating();alert('ì „ì²´ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•™ìƒ ì¶”ê°€ì™€ ì¢Œì„ ë°°ì¹˜ë¥¼ ìƒˆë¡œ ì„¤ì •í•˜ì„¸ìš”.')}

function getSt(id,st){const key=`${s.date}_${s.time}_${id}`;if(s.att[key])return s.att[key];const days=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];const d=new Date(s.date);const day=days[d.getDay()];if(st.ë¶ˆì°¸==='-')return'none';const exc=st.ë¶ˆì°¸.split(',').map(x=>x.trim());for(let e of exc){if(e.includes(day)){if(e.includes('ì˜¤ì „')&&s.time==='ì˜¤ì „')return'excused';if(e.includes('ì˜¤í›„')&&s.time==='ì˜¤í›„')return'excused';if(!e.includes('ì˜¤ì „')&&!e.includes('ì˜¤í›„'))return'excused'}}return'none'}

function renderSeating(){const chart=document.getElementById('seating-chart');chart.innerHTML='';['2','1'].forEach(grade=>{const div=document.createElement('div');div.innerHTML=`<div class="floor-label">${grade}í•™ë…„</div>`;const grid=document.createElement('div');grid.className='seat-grid';const seats=seatingLayout[grade];seats.forEach(row=>{row.forEach(id=>{const se=document.createElement('div');if(id==='X'){se.className='seat blocked'}else if(!id){se.className='seat empty'}else{const st=[...g1,...g2].find(x=>x.í•™ë²ˆ===id);if(st){const status=getSt(id,st);se.className=`seat ${status}`;se.innerHTML=`<div class="seat-number">${id.substring(1)}</div><div class="seat-id">${id}</div><div class="seat-name">${st.ì´ë¦„}</div>`}else{se.className='seat empty'}}grid.appendChild(se)})});grid.style.gridTemplateRows=`repeat(${seats.length}, 1fr)`;div.appendChild(grid);chart.appendChild(div)})}

function init(){loadData();document.getElementById('date').value=s.date;update();setInterval(()=>document.getElementById('timeDisplay').textContent='í˜„ì¬: '+new Date().toLocaleTimeString('ko-KR',{hour12:false}),1000);setInterval(autoAbs,60000);document.getElementById('input').addEventListener('keypress',e=>{if(e.key==='Enter')process()})}

function setGrade(g){s.grade=g;document.querySelectorAll('.controls > div:first-child .btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');render()}

function setTime(t){s.time=t;document.querySelectorAll('.controls > div:last-child .btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');update()}

function update(){s.date=document.getElementById('date').value;const days=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];const d=new Date(s.date);const day=days[d.getDay()];document.getElementById('dateDisplay').textContent=`${s.date} (${day})`;render()}

function render(){const students=s.grade==='all'?[...g1,...g2]:s.grade==='1'?g1:g2;let total=0,present=0,late=0,absent=0;const tbody=document.getElementById('table');tbody.innerHTML='';students.forEach(st=>{const status=getSt(st.í•™ë²ˆ,st);const key=`${s.date}_${s.time}_${st.í•™ë²ˆ}`;const actualStatus=s.att[key]||status;if(actualStatus==='present')present++;if(actualStatus==='late')late++;if(actualStatus==='absent')absent++;total++;const tr=document.createElement('tr');tr.innerHTML=`<td>${st.í•™ë²ˆ}</td><td>${st.ì´ë¦„}</td><td style="text-align:center;"><span class="badge ${actualStatus}">${actualStatus==='present'?'ì¶œì„':actualStatus==='late'?'ì§€ê°':actualStatus==='absent'?'ê²°ì„':actualStatus==='excused'?'ë¶ˆì°¸':'ë¯¸ì²´í¬'}</span></td><td style="text-align:center;">${st.ë¶ˆì°¸}</td>`;tbody.appendChild(tr)});document.getElementById('total').textContent=total;document.getElementById('present').textContent=present;document.getElementById('late').textContent=late;document.getElementById('absent').textContent=absent}

function process(){const id=document.getElementById('input').value.trim();document.getElementById('input').value='';if(!id)return;const st=[...g1,...g2].find(x=>x.í•™ë²ˆ===id);if(!st){showMsg('í•™ë²ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤','error');return}const now=new Date();const h=now.getHours();const m=now.getMinutes();const key=`${s.date}_${s.time}_${id}`;const excused=getSt(id,st)==='excused';if(excused){showMsg(`${st.ì´ë¦„} - ë¶ˆì°¸ ì²˜ë¦¬ë¨`,'warning');s.att[key]='excused'}else if(s.time==='ì˜¤ì „'){if(h<9||(h===9&&m<30)){showMsg(`${st.ì´ë¦„} - ì¶œì„`,'success');s.att[key]='present'}else{showMsg(`${st.ì´ë¦„} - ì§€ê°`,'warning');s.att[key]='late'}}else{if(h<14||(h===14&&m<30)){showMsg(`${st.ì´ë¦„} - ì¶œì„`,'success');s.att[key]='present'}else{showMsg(`${st.ì´ë¦„} - ì§€ê°`,'warning');s.att[key]='late'}}localStorage.setItem('attendance',JSON.stringify(s.att));render();renderSeating()}

function showMsg(text,type){const msg=document.getElementById('msg');msg.textContent=text;msg.className=type;msg.style.display='block';setTimeout(()=>msg.style.display='none',3000)}

function autoAbs(){const now=new Date();const h=now.getHours();const m=now.getMinutes();if(s.time==='ì˜¤ì „'&&h===10&&m===0){[...g1,...g2].forEach(st=>{const key=`${s.date}_${s.time}_${st.í•™ë²ˆ}`;if(!s.att[key]){const excused=getSt(st.í•™ë²ˆ,st)==='excused';s.att[key]=excused?'excused':'absent'}});localStorage.setItem('attendance',JSON.stringify(s.att));render();renderSeating()}if(s.time==='ì˜¤í›„'&&h===15&&m===0){[...g1,...g2].forEach(st=>{const key=`${s.date}_${s.time}_${st.í•™ë²ˆ}`;if(!s.att[key]){const excused=getSt(st.í•™ë²ˆ,st)==='excused';s.att[key]=excused?'excused':'absent'}});localStorage.setItem('attendance',JSON.stringify(s.att));render();renderSeating()}}

function download(){const students=s.grade==='all'?[...g1,...g2]:s.grade==='1'?g1:g2;let csv='í•™ë²ˆ,ì´ë¦„,ìƒíƒœ,ë¶ˆì°¸\n';students.forEach(st=>{const status=getSt(st.í•™ë²ˆ,st);const key=`${s.date}_${s.time}_${st.í•™ë²ˆ}`;const actualStatus=s.att[key]||status;const statusText=actualStatus==='present'?'ì¶œì„':actualStatus==='late'?'ì§€ê°':actualStatus==='absent'?'ê²°ì„':actualStatus==='excused'?'ë¶ˆì°¸':'ë¯¸ì²´í¬';csv+=`${st.í•™ë²ˆ},${st.ì´ë¦„},${statusText},${st.ë¶ˆì°¸}\n`});const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`ì¶œì„ì²´í¬_${s.date}_${s.time}.csv`;a.click()}

init();
</script>
</body>
</html>
